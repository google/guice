<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_181-google-v7) on Thu Mar 19 15:58:19 EDT 2020 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SingletonScope (Google Guice - Core Library 4.2.3 API)</title>
<meta name="date" content="2020-03-19">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="SingletonScope (Google Guice - Core Library 4.2.3 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/SingletonScope.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/google/inject/internal/Scoping.html" title="class in com.google.inject.internal"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/google/inject/internal/UniqueAnnotations.html" title="class in com.google.inject.internal"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/google/inject/internal/SingletonScope.html" target="_top">Frames</a></li>
<li><a href="SingletonScope.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.google.inject.internal</div>
<h2 title="Class SingletonScope" class="title">Class SingletonScope</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.google.inject.internal.SingletonScope</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../com/google/inject/Scope.html" title="interface in com.google.inject">Scope</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">SingletonScope</span>
extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>
implements <a href="../../../../com/google/inject/Scope.html" title="interface in com.google.inject">Scope</a></pre>
<div class="block">One instance per <a href="../../../../com/google/inject/Injector.html" title="interface in com.google.inject"><code>Injector</code></a>. Also see <code>@</code><a href="../../../../com/google/inject/Singleton.html" title="annotation in com.google.inject"><code>Singleton</code></a>.

 <p>Introduction from the author: Implementation of this class seems unreasonably complicated at
 the first sight. I fully agree with you, that the beast below is very complex and it's hard to
 reason on how does it work or not. Still I want to assure you that hundreds(?) of hours were
 thrown into making this code simple, while still maintaining Singleton contract.

 <p>Anyway, why is it so complex? Singleton scope does not seem to be that unique.

 <ol>
   <li>Guice has never truly expected to be used in multi threading environment with many
       Injectors working alongside each other. There is almost no code with Guice that propagates
       state between threads. And Singleton scope is The exception.
   <li>Guice supports circular dependencies and thus manages proxy objects. There is no interface
       that allows user defined Scopes to create proxies, it is expected to be done by Guice.
       Singleton scope needs to be able to detect circular dependencies spanning several threads,
       therefore Singleton scope needs to be able to create these proxies.
   <li>To make things worse, Guice has a very tricky definition for a binding resolution when
       Injectors are in in a parent/child relationship. And Scope does not have access to this
       information by design, the only real action that Scope can do is to call or not to call a
       creator.
   <li>There is no readily available code in Guice that can detect a potential deadlock, and no
       code for handling dependency cycles spanning several threads. This is significantly harder
       as all the dependencies in a thread at runtime can be represented with a list, where in a
       multi threaded environment we have more complex dependency trees.
   <li>Guice has a pretty strong contract regarding Garbage Collection, which often prevents us
       from linking objects directly. So simple domain specific code can not be written and
       intermediary id objects need to be managed.
   <li>Guice is relatively fast and we should not make things worse. We're trying our best to
       optimize synchronization for speed and memory. Happy path should be almost as fast as in a
       single threaded solution and should not take much more memory.
   <li>Error message generation in Guice was not meant to be used like this and to work around its
       APIs we need a lot of code. Additional complexity comes from inherent data races as message
       is only generated when failure occurs on proxy object generation. Things get ugly pretty
       fast.
 </ol></div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>timofeyb (Timothy Basanov)</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../com/google/inject/internal/SingletonScope.html#scope-com.google.inject.Key-com.google.inject.Provider-"><code>scope(Key, Provider)</code></a>, 
<code>CycleDetectingLock</code></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../com/google/inject/internal/SingletonScope.html#SingletonScope--">SingletonScope</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>&lt;T&gt;&nbsp;<a href="../../../../com/google/inject/Provider.html" title="interface in com.google.inject">Provider</a>&lt;T&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/google/inject/internal/SingletonScope.html#scope-com.google.inject.Key-com.google.inject.Provider-">scope</a></span>(<a href="../../../../com/google/inject/Key.html" title="class in com.google.inject">Key</a>&lt;T&gt;&nbsp;key,
     <a href="../../../../com/google/inject/Provider.html" title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;creator)</code>
<div class="block">Provides singleton scope with the following properties:

 
   creates no more than one instance per Key as a creator is used no more than once
   result is cached and returned quickly on subsequent calls
   exception in a creator is not treated as instance creation and is not cached
   creates singletons in parallel whenever possible
   waits for dependent singletons to be created even across threads and when dependencies
       are shared as long as no circular dependencies are detected
   returns circular proxy only when circular dependencies are detected
   aside from that, blocking synchronization is only used for proxy creation and
       initialization
 </div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/google/inject/internal/SingletonScope.html#toString--">toString</a></span>()</code>
<div class="block">A short but useful description of this scope.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="SingletonScope--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>SingletonScope</h4>
<pre>public&nbsp;SingletonScope()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="scope-com.google.inject.Key-com.google.inject.Provider-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>scope</h4>
<pre>public&nbsp;&lt;T&gt;&nbsp;<a href="../../../../com/google/inject/Provider.html" title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;scope(<a href="../../../../com/google/inject/Key.html" title="class in com.google.inject">Key</a>&lt;T&gt;&nbsp;key,
                             <a href="../../../../com/google/inject/Provider.html" title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;creator)</pre>
<div class="block">Provides singleton scope with the following properties:

 <ul>
   <li>creates no more than one instance per Key as a creator is used no more than once
   <li>result is cached and returned quickly on subsequent calls
   <li>exception in a creator is not treated as instance creation and is not cached
   <li>creates singletons in parallel whenever possible
   <li>waits for dependent singletons to be created even across threads and when dependencies
       are shared as long as no circular dependencies are detected
   <li>returns circular proxy only when circular dependencies are detected
   <li>aside from that, blocking synchronization is only used for proxy creation and
       initialization
 </ul></div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../com/google/inject/Scope.html#scope-com.google.inject.Key-com.google.inject.Provider-">scope</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/google/inject/Scope.html" title="interface in com.google.inject">Scope</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>key</code> - binding key</dd>
<dd><code>creator</code> - locates an instance when one doesn't already exist in this scope.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a new provider which only delegates to the given unscoped provider when an instance of
     the requested object doesn't already exist in this scope</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../com/google/inject/internal/CycleDetectingLock.CycleDetectingLockFactory.html" title="class in com.google.inject.internal"><code>CycleDetectingLock.CycleDetectingLockFactory</code></a></dd>
</dl>
</li>
</ul>
<a name="toString--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>toString</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;toString()</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="../../../../com/google/inject/Scope.html#toString--">Scope</a></code></span></div>
<div class="block">A short but useful description of this scope. For comparison, the standard scopes that ship
 with guice use the descriptions <code>"Scopes.SINGLETON"</code>, <code>"ServletScopes.SESSION"</code> and
 <code>"ServletScopes.REQUEST"</code>.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../com/google/inject/Scope.html#toString--">toString</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/google/inject/Scope.html" title="interface in com.google.inject">Scope</a></code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a></code>&nbsp;in class&nbsp;<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/SingletonScope.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/google/inject/internal/Scoping.html" title="class in com.google.inject.internal"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/google/inject/internal/UniqueAnnotations.html" title="class in com.google.inject.internal"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/google/inject/internal/SingletonScope.html" target="_top">Frames</a></li>
<li><a href="SingletonScope.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2006&#x2013;2020 <a href="http://www.google.com">Google, Inc.</a>. All rights reserved.</small></p>
</body>
</html>
